<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecturer Dashboard - {{ course.name }} - UniPortal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome-local.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=20241215">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar-fix.css') }}?v=20241215">
    
    <!-- Device-specific CSS -->
    {% if is_mobile %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}?v=20241215">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile_force.css') }}?v=20241215">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-scroll-fix.css') }}?v=20241215">
    {% endif %}
</head>
<body class="dashboard-page">
    <!-- Mobile Top Bar -->
    <div class="mobile-top-bar">
        <button class="mobile-hamburger" id="mobileMenuToggle" onclick="toggleMobileSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <div class="mobile-logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="UniPortal">
            <span>{{ course.name }}</span>
        </div>
        <a href="{{ url_for('main.profile') }}" class="mobile-avatar">
            {{ current_user.full_name[0] if current_user.full_name else current_user.username[0] }}
        </a>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="UniPortal">
                <span>{{ course.name }} - Lecturer</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" onclick="showView('dashboard'); return false;">
                <span class="icon"><i class="fas fa-home"></i></span>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" onclick="showView('assignments'); return false;">
                <span class="icon"><i class="fas fa-file-alt"></i></span>
                <span>Assignments</span>
            </a>
            <a href="#" class="nav-item" onclick="showView('resources'); return false;">
                <span class="icon"><i class="fas fa-folder"></i></span>
                <span>Course Materials</span>
            </a>
            <a href="#" class="nav-item" onclick="showView('attendance'); return false;">
                <span class="icon"><i class="fas fa-clipboard-check"></i></span>
                <span>Attendance</span>
            </a>
            <a href="#" class="nav-item" onclick="showView('analytics'); return false;">
                <span class="icon"><i class="fas fa-chart-line"></i></span>
                <span>Analytics</span>
            </a>
            <a href="{{ url_for('main.class_chat') }}" class="nav-item">
                <span class="icon"><i class="fas fa-comments"></i></span>
                <span>Class Chat</span>
            </a>
            <a href="{{ url_for('main.forum') }}" class="nav-item">
                <span class="icon"><i class="fas fa-newspaper"></i></span>
                <span>Forum</span>
            </a>
            <a href="{{ url_for('main.settings') }}" class="nav-item">
                <span class="icon"><i class="fas fa-cog"></i></span>
                <span>Settings</span>
            </a>
            <a href="{{ url_for('main.logout') }}" class="nav-item" onclick="return confirmLogout(event);">
                <span class="icon"><i class="fas fa-sign-out-alt"></i></span>
                <span>Logout</span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-msg {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Dashboard View -->
        <div id="dashboardView" class="view-section active">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-graduation-cap"></i> {{ course.name }} - Lecturer Dashboard
                </h1>
                <p style="color: rgba(255, 255, 255, 0.8); font-size: 16px; margin-top: 10px;">
                    Manage your course: assignments, resources, attendance, and analytics
                </p>
            </div>

            <!-- Quick Actions -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <a href="{{ url_for('main.lecturer_create_assignment') }}" 
                   style="display: flex; align-items: center; gap: 15px; padding: 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; text-decoration: none; color: white; transition: transform 0.3s; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);"
                   onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <div style="font-size: 32px;">üìù</div>
                    <div>
                        <h3 style="margin: 0; font-size: 16px; font-weight: 600;">Create Assignment</h3>
                        <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">Give new assignments to students</p>
                    </div>
                </a>

                <a href="{{ url_for('main.lecturer_upload_slides') }}" 
                   style="display: flex; align-items: center; gap: 15px; padding: 20px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); border-radius: 12px; text-decoration: none; color: white; transition: transform 0.3s; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);"
                   onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <div style="font-size: 32px;">üìö</div>
                    <div>
                        <h3 style="margin: 0; font-size: 16px; font-weight: 600;">Upload Slides</h3>
                        <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">Upload multiple lecture slides</p>
                    </div>
                </a>

                <a href="{{ url_for('main.attendance_dashboard') }}" 
                   style="display: flex; align-items: center; gap: 15px; padding: 20px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 12px; text-decoration: none; color: white; transition: transform 0.3s; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);"
                   onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <div style="font-size: 32px;">‚úÖ</div>
                    <div>
                        <h3 style="margin: 0; font-size: 16px; font-weight: 600;">Take Attendance</h3>
                        <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">Start attendance session</p>
                    </div>
                </a>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card blue">
                    <div class="stat-content">
                        <div class="stat-value">{{ total_assignments }}</div>
                        <div class="stat-label">Total Assignments</div>
                    </div>
                    <div class="stat-icon">üìÑ</div>
                </div>
                
                <div class="stat-card green">
                    <div class="stat-content">
                        <div class="stat-value">{{ graded_assignments }}</div>
                        <div class="stat-label">Graded</div>
                    </div>
                    <div class="stat-icon">‚úÖ</div>
                </div>
                
                <div class="stat-card orange">
                    <div class="stat-content">
                        <div class="stat-value">{{ pending_assignments }}</div>
                        <div class="stat-label">Pending Review</div>
                    </div>
                    <div class="stat-icon">‚è≥</div>
                </div>
                
                <div class="stat-card red">
                    <div class="stat-content">
                        <div class="stat-value">{{ total_students }}</div>
                        <div class="stat-label">Enrolled Students</div>
                    </div>
                    <div class="stat-icon">üë•</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="glass-card" style="margin-bottom: 30px;">
                <div class="card-header">
                    <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button onclick="showView('resources')" class="btn-primary" style="width: 100%;">
                            <i class="fas fa-upload"></i> Upload Materials
                        </button>
                        <button onclick="showView('attendance')" class="btn-primary" style="width: 100%;">
                            <i class="fas fa-clipboard-check"></i> Start Attendance
                        </button>
                        <button onclick="showView('assignments')" class="btn-primary" style="width: 100%;">
                            <i class="fas fa-star"></i> Grade Assignments
                        </button>
                        <button onclick="showView('analytics')" class="btn-primary" style="width: 100%;">
                            <i class="fas fa-chart-line"></i> View Analytics
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="glass-card">
                <div class="card-header">
                    <h2><i class="fas fa-clock"></i> Recent Activity</h2>
                </div>
                <div class="card-body">
                    {% if recent_assignments %}
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>Assignment</th>
                                        <th>Submitted</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for assignment in recent_assignments %}
                                    <tr>
                                        <td>{{ assignment.user.full_name or assignment.user.username }}</td>
                                        <td>{{ assignment.filename }}</td>
                                        <td>{{ assignment.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                        <td>
                                            {% if assignment.grade %}
                                                <span class="badge-success">Graded ({{ assignment.grade }})</span>
                                            {% else %}
                                                <span class="badge-warning">Pending</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <a href="{{ url_for('main.preview_assignment', assignment_id=assignment.id) }}" class="btn btn-preview" target="_blank">
                                                    <i class="fas fa-eye"></i> Preview
                                                </a>
                                                {% if not assignment.grade %}
                                                <a href="{{ url_for('main.grade_assignment', assignment_id=assignment.id) }}" class="btn btn-grade">
                                                    <i class="fas fa-star"></i> Grade
                                                </a>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No recent assignments for {{ course.name }}</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Assignments View -->
        <div id="assignmentsView" class="view-section">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-file-alt"></i> {{ course.name }} - Assignments
                </h1>
                <a href="{{ url_for('main.download_by_course', course_id=course.id) }}" class="btn-download-all">
                    <i class="fas fa-download"></i> Download All
                </a>
            </div>

            <div class="glass-card">
                <div class="card-body">
                    {% if assignments %}
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>File</th>
                                        <th>Submitted</th>
                                        <th>Grade</th>
                                        <th>Similarity</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for assignment in assignments %}
                                    <tr>
                                        <td>{{ assignment.user.full_name or assignment.user.username }}</td>
                                        <td>
                                            <div class="file-info">
                                                <i class="fas fa-file-alt"></i>
                                                <span>{{ assignment.filename }}</span>
                                            </div>
                                        </td>
                                        <td>{{ assignment.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                        <td>
                                            {% if assignment.grade %}
                                                <span class="grade-score">{{ assignment.grade }}</span>
                                            {% else %}
                                                <span class="badge-warning">Pending</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if assignment.similarity_score %}
                                                {% if assignment.similarity_score > 70 %}
                                                    <span class="similarity-badge similarity-high">{{ assignment.similarity_score }}%</span>
                                                {% elif assignment.similarity_score > 40 %}
                                                    <span class="similarity-badge similarity-medium">{{ assignment.similarity_score }}%</span>
                                                {% else %}
                                                    <span class="similarity-badge similarity-low">{{ assignment.similarity_score }}%</span>
                                                {% endif %}
                                            {% else %}
                                                <span class="badge-info">Analyzing...</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <a href="{{ url_for('main.download_assignment', assignment_id=assignment.id) }}" class="btn btn-download">
                                                    <i class="fas fa-download"></i>
                                                </a>
                                                <a href="{{ url_for('main.preview_assignment', assignment_id=assignment.id) }}" class="btn btn-preview" target="_blank">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                {% if not assignment.grade %}
                                                <a href="{{ url_for('main.grade_assignment', assignment_id=assignment.id) }}" class="btn btn-grade">
                                                    <i class="fas fa-star"></i>
                                                </a>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No assignments submitted for {{ course.name }} yet</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Resources View -->
        <div id="resourcesView" class="view-section">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-folder"></i> {{ course.name }} - Course Materials
                </h1>
            </div>

            <!-- Upload Form -->
            <div class="glass-card" style="margin-bottom: 30px;">
                <div class="card-header">
                    <h2><i class="fas fa-upload"></i> Upload Course Material</h2>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('main.upload_slide') }}" enctype="multipart/form-data">
                        <input type="hidden" name="course_id" value="{{ course.id }}">
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label>Material Title</label>
                                <input type="text" name="title" required placeholder="e.g., Week 1 Lecture Slides">
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select name="category" required>
                                    <option value="Lecture Slides">Lecture Slides</option>
                                    <option value="Assignment">Assignment</option>
                                    <option value="Reading Material">Reading Material</option>
                                    <option value="Lab Manual">Lab Manual</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label>Description (Optional)</label>
                            <textarea name="description" rows="3" placeholder="Brief description of the material..."></textarea>
                        </div>
                        
                        <div class="upload-zone" onclick="document.getElementById('slideFile').click()">
                            <div class="upload-icon">üìÅ</div>
                            <p>Click to select file or drag and drop</p>
                            <small>Supported: PDF, DOC, DOCX, PPT, PPTX (Max: 50MB)</small>
                        </div>
                        <input type="file" id="slideFile" name="file" accept=".pdf,.doc,.docx,.ppt,.pptx" required style="display: none;">
                        
                        <button type="submit" class="btn-primary" style="width: 100%; margin-top: 15px;">
                            <i class="fas fa-upload"></i> Upload Material
                        </button>
                    </form>
                </div>
            </div>

            <!-- Materials List -->
            <div class="glass-card">
                <div class="card-header">
                    <h2><i class="fas fa-folder-open"></i> Uploaded Materials</h2>
                </div>
                <div class="card-body">
                    {% if resources %}
                        <div class="resources-grid">
                            {% for resource in resources %}
                            <div class="resource-item">
                                <div class="resource-icon">
                                    {% if resource.filename.endswith('.pdf') %}
                                        üìÑ
                                    {% elif resource.filename.endswith(('.ppt', '.pptx')) %}
                                        üìä
                                    {% elif resource.filename.endswith(('.doc', '.docx')) %}
                                        üìù
                                    {% else %}
                                        üìÅ
                                    {% endif %}
                                </div>
                                <div class="resource-info">
                                    <h3>{{ resource.title or resource.filename }}</h3>
                                    <div class="resource-meta">
                                        <span class="badge-info">{{ resource.category }}</span>
                                        <span>{{ resource.created_at.strftime('%Y-%m-%d') }}</span>
                                    </div>
                                    {% if resource.description %}
                                        <div class="resource-description">{{ resource.description }}</div>
                                    {% endif %}
                                </div>
                                <div class="action-buttons">
                                    <a href="{{ url_for('main.download_slide', slide_id=resource.id) }}" class="btn btn-download">
                                        <i class="fas fa-download"></i>
                                    </a>
                                    {% if current_user.id == resource.uploader_id %}
                                    <a href="{{ url_for('main.delete_slide', slide_id=resource.id) }}" class="btn" style="background: rgba(239, 68, 68, 0.3); color: white;" onclick="return confirm('Delete this material?')">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-folder-open" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No materials uploaded for {{ course.name }} yet</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Attendance View -->
        <div id="attendanceView" class="view-section">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-clipboard-check"></i> {{ course.name }} - Attendance
                </h1>
            </div>

            <!-- Start Attendance Session -->
            <div class="glass-card" style="margin-bottom: 30px;">
                <div class="card-header">
                    <h2><i class="fas fa-play"></i> Start Attendance Session</h2>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('main.start_attendance') }}" id="attendanceForm">
                        <input type="hidden" name="course_id" value="{{ course.id }}">
                        <input type="hidden" id="repLatitude" name="latitude">
                        <input type="hidden" id="repLongitude" name="longitude">
                        
                        <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 20px;">
                            Start an attendance session for {{ course.name }}. Students within 50 meters can mark attendance.
                        </p>
                        
                        <div id="locationStatus" style="display: none; padding: 15px; border-radius: 10px; margin-bottom: 20px;"></div>
                        
                        <button type="button" onclick="startAttendanceSession()" class="btn-primary" style="width: 100%;">
                            <i class="fas fa-location-arrow"></i> Start Session (Get Location)
                        </button>
                    </form>
                </div>
            </div>

            <!-- Attendance Records -->
            <div class="glass-card">
                <div class="card-header">
                    <h2><i class="fas fa-list"></i> Attendance Records</h2>
                    <a href="{{ url_for('main.export_attendance', course_id=course.id) }}" class="btn-secondary">
                        <i class="fas fa-download"></i> Export CSV
                    </a>
                </div>
                <div class="card-body">
                    {% if attendance_sessions %}
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Session Date</th>
                                        <th>Students Present</th>
                                        <th>Total Students</th>
                                        <th>Attendance Rate</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for session in attendance_sessions %}
                                    <tr>
                                        <td>{{ session.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                        <td>{{ session.records|length }}</td>
                                        <td>{{ total_students }}</td>
                                        <td>
                                            {% set rate = ((session.records|length / total_students) * 100) if total_students > 0 else 0 %}
                                            {{ "%.1f"|format(rate) }}%
                                        </td>
                                        <td>
                                            {% if session.is_active %}
                                                <span class="badge-success">Active</span>
                                            {% else %}
                                                <span class="badge-info">Completed</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-clipboard-check" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No attendance sessions for {{ course.name }} yet</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Analytics View -->
        <div id="analyticsView" class="view-section">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-chart-line"></i> {{ course.name }} - Analytics
                </h1>
            </div>

            <!-- Analytics Stats -->
            <div class="stats-grid" style="margin-bottom: 30px;">
                <div class="stat-card blue">
                    <div class="stat-content">
                        <div class="stat-value">{{ analytics.avg_grade or 0 }}%</div>
                        <div class="stat-label">Average Grade</div>
                    </div>
                    <div class="stat-icon">üìä</div>
                </div>
                
                <div class="stat-card green">
                    <div class="stat-content">
                        <div class="stat-value">{{ analytics.submission_rate or 0 }}%</div>
                        <div class="stat-label">Submission Rate</div>
                    </div>
                    <div class="stat-icon">üìà</div>
                </div>
                
                <div class="stat-card orange">
                    <div class="stat-content">
                        <div class="stat-value">{{ analytics.avg_attendance or 0 }}%</div>
                        <div class="stat-label">Avg Attendance</div>
                    </div>
                    <div class="stat-icon">üë•</div>
                </div>
                
                <div class="stat-card red">
                    <div class="stat-content">
                        <div class="stat-value">{{ analytics.plagiarism_alerts or 0 }}</div>
                        <div class="stat-label">Plagiarism Alerts</div>
                    </div>
                    <div class="stat-icon">‚ö†Ô∏è</div>
                </div>
            </div>

            <!-- Performance Overview -->
            <div class="glass-card">
                <div class="card-header">
                    <h2><i class="fas fa-chart-bar"></i> {{ course.name }} Performance Overview</h2>
                </div>
                <div class="card-body">
                    <p style="color: rgba(255, 255, 255, 0.9); text-align: center; padding: 40px;">
                        Detailed analytics for {{ course.name }} will be displayed here.
                        <br><br>
                        <i class="fas fa-chart-line" style="font-size: 48px; opacity: 0.5;"></i>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/geolocation-fix.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mobile.js') }}"></script>
    
    <script>
        function confirmLogout(event) {
            if (!confirm('Are you sure you want to logout?')) {
                event.preventDefault();
                return false;
            }
            return true;
        }

        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected view
            document.getElementById(viewName + 'View').classList.add('active');
            
            // Add active class to clicked nav item
            event.target.closest('.nav-item').classList.add('active');
        }

        // Attendance session function
        function startAttendanceSession() {
            const locationStatus = document.getElementById('locationStatus');
            locationStatus.style.display = 'block';
            
            // Use enhanced geolocation system
            startAttendanceWithLocation('attendanceForm', 'locationStatus');
        }

        // Auto-hide flash messages
        setTimeout(() => {
            document.querySelectorAll('.flash-msg').forEach(msg => {
                msg.style.opacity = '0';
                msg.style.transform = 'translateY(-10px)';
                setTimeout(() => msg.remove(), 500);
            });
        }, 5000);

        // File upload preview
        document.getElementById('slideFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const uploadZone = document.querySelector('.upload-zone');
                uploadZone.innerHTML = `
                    <div class="upload-icon">üìÅ</div>
                    <p><strong>Selected:</strong> ${file.name}</p>
                    <small>Size: ${(file.size / 1024 / 1024).toFixed(2)} MB</small>
                `;
            }
        });
    </script>
</body>
</html>