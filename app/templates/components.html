{# Reusable Jinja2 Macros for UniPortal #}

{# Card Macro - Glassmorphism container with title #}
{% macro card(title, color='white') %}
<div class="glass-card">
    <div class="card-header">
        <h2>{{ title | safe }}</h2>
    </div>
    <div class="card-body">
        {{ caller() }}
    </div>
</div>
{% endmacro %}

{# Badge Macro - Status pills with color variants #}
{% macro badge(text, type='info') %}
{% if type == 'success' %}
<span class="badge badge-success">{{ text | safe }}</span>
{% elif type == 'warning' %}
<span class="badge badge-warning">{{ text | safe }}</span>
{% elif type == 'danger' %}
<span class="badge badge-danger">{{ text | safe }}</span>
{% else %}
<span class="badge badge-info">{{ text | safe }}</span>
{% endif %}
{% endmacro %}

{# Autocomplete Search Macro - Smart search with suggestions using Alpine.js #}
{% macro autocomplete(name, placeholder, data_list, initial_value='') %}
<div x-data="{
    query: '{{ initial_value }}',
    showDropdown: false,
    suggestions: {{ data_list | tojson }},
    get filteredItems() {
        if (this.query.length < 2) return [];
        const searchTerm = this.query.toLowerCase();
        return this.suggestions.filter(item => 
            item.toLowerCase().includes(searchTerm)
        ).slice(0, 5);
    },
    selectItem(item) {
        this.query = item;
        this.showDropdown = false;
        this.$refs.searchForm.submit();
    }
}" 
@click.away="showDropdown = false"
style="position: relative; max-width: 600px;">
    <form method="GET" action="{{ url_for('main.library') }}" x-ref="searchForm">
        <div style="display: flex; gap: 10px;">
            <div style="position: relative; flex: 1;">
                <input 
                    type="text" 
                    name="{{ name }}" 
                    x-model="query"
                    @input="showDropdown = true"
                    @focus="showDropdown = true"
                    placeholder="{{ placeholder }}" 
                    autocomplete="off"
                    style="width: 100%; padding: 12px 20px; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 25px; background: rgba(255, 255, 255, 0.1); color: white; font-size: 14px; transition: all 0.3s ease;"
                    autofocus>
                
                <!-- Autocomplete Dropdown -->
                <div 
                    x-show="showDropdown && filteredItems.length > 0"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 transform scale-100"
                    x-transition:leave-end="opacity-0 transform scale-95"
                    style="position: absolute; top: 100%; left: 0; right: 0; margin-top: 8px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); z-index: 1000; overflow: hidden;">
                    <template x-for="(item, index) in filteredItems" :key="index">
                        <div 
                            @click="selectItem(item)"
                            style="padding: 12px 20px; color: white; cursor: pointer; transition: background 0.2s ease; border-bottom: 1px solid rgba(255, 255, 255, 0.1);"
                            @mouseenter="$el.style.background = 'rgba(255, 255, 255, 0.15)'"
                            @mouseleave="$el.style.background = 'transparent'">
                            <i class="fas fa-search" style="margin-right: 10px; color: rgba(255, 255, 255, 0.6);"></i>
                            <span x-text="item"></span>
                        </div>
                    </template>
                </div>
            </div>
            
            <button 
                type="submit" 
                style="padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 14px; font-weight: 600; transition: transform 0.2s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);"
                @mouseenter="$el.style.transform = 'scale(1.05)'"
                @mouseleave="$el.style.transform = 'scale(1)'">
                <i class="fas fa-search"></i> Search
            </button>
        </div>
    </form>
</div>
{% endmacro %}

{# Loading Spinner Macro - HeroUI-inspired spinner #}
{% macro spinner(size='md', color='blue') %}
{% if size == 'lg' %}
    {% set width = '48px' %}
    {% set height = '48px' %}
{% elif size == 'sm' %}
    {% set width = '20px' %}
    {% set height = '20px' %}
{% else %}
    {% set width = '32px' %}
    {% set height = '32px' %}
{% endif %}

{% if color == 'white' %}
    {% set border_color = 'white' %}
{% elif color == 'green' %}
    {% set border_color = '#10b981' %}
{% elif color == 'red' %}
    {% set border_color = '#ef4444' %}
{% else %}
    {% set border_color = '#667eea' %}
{% endif %}

<div style="display: flex; justify-content: center; align-items: center;">
    <div style="width: {{ width }}; height: {{ height }}; border: 3px solid rgba(255, 255, 255, 0.2); border-top-color: {{ border_color }}; border-radius: 50%; animation: spin 0.8s linear infinite;"></div>
</div>
{% endmacro %}
