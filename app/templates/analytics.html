<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - UniPortal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome-local.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="dashboard-page">
    <!-- Mobile Top Bar -->
    <div class="mobile-top-bar">
        <button class="mobile-hamburger" onclick="toggleMobileSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <div class="mobile-logo">
            <img src="/static/logo.png" alt="UniPortal">
            <span>UniPortal</span>
        </div>
        <div class="mobile-avatar">{{ current_user.avatar_initials }}</div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <img src="/static/logo.png" alt="UniPortal Logo">
                <span>UniPortal</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="{{ url_for('main.dashboard') }}" class="nav-item">
                <span class="icon"><i class="fas fa-home"></i></span>
                <span>Dashboard</span>
            </a>
            {% if current_user.role == 'Rep' %}
            <a href="{{ url_for('main.subscription') }}" class="nav-item">
                <span class="icon"><i class="fas fa-gem"></i></span>
                <span>Subscription</span>
            </a>
            <a href="{{ url_for('main.payment_history') }}" class="nav-item">
                <span class="icon"><i class="fas fa-receipt"></i></span>
                <span>Payment History</span>
            </a>
            {% endif %}
            <a href="{{ url_for('main.analytics') }}" class="nav-item active">
                <span class="icon"><i class="fas fa-chart-line"></i></span>
                <span>Analytics</span>
            </a>
            <a href="{{ url_for('main.logout') }}" class="nav-item">
                <span class="icon"><i class="fas fa-sign-out-alt"></i></span>
                <span>Logout</span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-msg {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Header -->
        <div class="page-header">
            <h1 class="page-title"><i class="fas fa-chart-line"></i> Analytics Dashboard</h1>
            <p style="color: rgba(255,255,255,0.7); font-size: 14px;">{{ role }} Overview</p>
        </div>

        {% if role == 'Admin' %}
        <!-- Admin Analytics -->
        <div class="stats-grid-responsive">
            <div class="stat-card blue">
                <i class="fas fa-school stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ total_classes }}</div>
                    <div class="stat-label">Total Classes</div>
                </div>
            </div>

            <div class="stat-card green">
                <i class="fas fa-check-circle stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ active_premium }}</div>
                    <div class="stat-label">Active Premium</div>
                </div>
            </div>

            <div class="stat-card red">
                <i class="fas fa-times-circle stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ expired_classes }}</div>
                    <div class="stat-label">Expired</div>
                </div>
            </div>

            <div class="stat-card orange">
                <i class="fas fa-money-bill-wave stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">GH‚Çµ{{ "%.0f"|format(total_revenue) }}</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
            <div class="table-card">
                <h2>User Statistics</h2>
                <div style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; margin-bottom: 10px;">
                        <span style="color: rgba(255,255,255,0.8);">Students</span>
                        <strong style="color: white;">{{ total_students }}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin-bottom: 10px;">
                        <span style="color: rgba(255,255,255,0.8);">Lecturers</span>
                        <strong style="color: white;">{{ total_lecturers }}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 8px;">
                        <span style="color: rgba(255,255,255,0.8);">Class Reps</span>
                        <strong style="color: white;">{{ total_reps }}</strong>
                    </div>
                </div>
            </div>

            <div class="table-card">
                <h2>Plan Distribution</h2>
                <div style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; margin-bottom: 10px;">
                        <span style="color: rgba(255,255,255,0.8);">üìö Semester Plans</span>
                        <strong style="color: white;">{{ semester_count }}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 15px; background: rgba(139, 92, 246, 0.1); border-radius: 8px;">
                        <span style="color: rgba(255,255,255,0.8);">üéì Yearly Plans</span>
                        <strong style="color: white;">{{ yearly_count }}</strong>
                    </div>
                </div>
            </div>
        </div>

        {% elif role == 'Rep' %}
        <!-- Rep Analytics -->
        <div class="stats-grid-responsive">
            <div class="stat-card blue">
                <i class="fas fa-users stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ class_students }}</div>
                    <div class="stat-label">Students</div>
                </div>
            </div>

            <div class="stat-card green">
                <i class="fas fa-file-alt stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ total_assignments }}</div>
                    <div class="stat-label">Assignments</div>
                </div>
            </div>

            <div class="stat-card orange">
                <i class="fas fa-folder stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ class_resources }}</div>
                    <div class="stat-label">Resources</div>
                </div>
            </div>

            <div class="stat-card purple" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                <i class="fas fa-comments stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ forum_posts }}</div>
                    <div class="stat-label">Forum Posts</div>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
            <div class="table-card">
                <h2>Assignment Progress</h2>
                <div style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin-bottom: 10px;">
                        <span style="color: rgba(255,255,255,0.8);">‚úì Graded</span>
                        <strong style="color: white;">{{ graded_assignments }}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 8px;">
                        <span style="color: rgba(255,255,255,0.8);">‚è≥ Pending</span>
                        <strong style="color: white;">{{ pending_assignments }}</strong>
                    </div>
                </div>
            </div>

            <div class="table-card">
                <h2>Subscription Status</h2>
                <div style="padding: 20px;">
                    {% if subscription_active %}
                        <div style="padding: 20px; background: rgba(16, 185, 129, 0.2); border-radius: 8px; text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 10px;">‚úì</div>
                            <div style="color: #10b981; font-size: 18px; font-weight: 600; margin-bottom: 5px;">Active</div>
                            <div style="color: rgba(255,255,255,0.7); font-size: 14px;">{{ days_remaining }} days remaining</div>
                        </div>
                    {% else %}
                        <div style="padding: 20px; background: rgba(239, 68, 68, 0.2); border-radius: 8px; text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 10px;">‚úó</div>
                            <div style="color: #ef4444; font-size: 18px; font-weight: 600; margin-bottom: 10px;">Expired</div>
                            <a href="{{ url_for('main.subscription') }}" class="btn-download-all" style="font-size: 13px; padding: 8px 16px;">Renew Now</a>
                        </div>
                    {% endif %}
                    <div style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <div style="color: rgba(255,255,255,0.7); font-size: 13px; margin-bottom: 5px;">Total Spent</div>
                        <div style="color: white; font-size: 24px; font-weight: 600;">GH‚Çµ{{ "%.2f"|format(total_spent) }}</div>
                    </div>
                </div>
            </div>
        </div>

        {% elif role == 'Lecturer' %}
        <!-- Lecturer Analytics -->
        <div class="stats-grid-responsive">
            <div class="stat-card blue">
                <i class="fas fa-book stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ total_courses }}</div>
                    <div class="stat-label">Courses</div>
                </div>
            </div>

            <div class="stat-card green">
                <i class="fas fa-file-alt stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ total_assignments }}</div>
                    <div class="stat-label">Total Assignments</div>
                </div>
            </div>

            <div class="stat-card orange">
                <i class="fas fa-check-circle stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ graded_assignments }}</div>
                    <div class="stat-label">Graded</div>
                </div>
            </div>

            <div class="stat-card red">
                <i class="fas fa-clock stat-icon"></i>
                <div class="stat-content">
                    <div class="stat-value">{{ pending_assignments }}</div>
                    <div class="stat-label">Pending</div>
                </div>
            </div>
        </div>

        <div class="table-card" style="margin-top: 30px;">
            <h2>Attendance Sessions</h2>
            <div style="padding: 20px; text-align: center;">
                <div style="font-size: 64px; color: rgba(59, 130, 246, 0.5); margin-bottom: 15px;">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <div style="font-size: 36px; font-weight: 600; color: white; margin-bottom: 10px;">{{ attendance_sessions }}</div>
                <div style="color: rgba(255,255,255,0.7); font-size: 14px;">Total Sessions Created</div>
            </div>
        </div>
        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
